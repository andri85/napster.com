using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.IO;
namespace Gestione_File_Stream
{
    class Program
    {

        static void Main(string[] args)
        {
            string vlc_napster_link = "https://napster85.herokuapp.com/uptobox.php?type=m3u&code=";
           
            MENU:

            Console.Title = "Gestione File Plex";

            Console.Write("Inserisci percorso file di input!:");

            string path_input = Console.ReadLine();

            if (File.Exists(path_input))
            {

                string path = @"C:\\Temp\\Kodi\\";

                if (!Directory.Exists(path))
                {

                    DirectoryInfo directoryInfo = Directory.CreateDirectory(path);

                    string lines;

                    string file_name = "";

                    string codice_uptobox = "";

                    int counter = 0;

                    StreamReader streamReader = new StreamReader(path_input);

                    while ((lines = streamReader.ReadLine()) != null)
                    {

                        string lines_1 = lines.Replace(",", "");
                          
                            String[] splitta = lines_1.Split('/');

                            file_name = splitta[4];

                            codice_uptobox = splitta[3];

                            Console.WriteLine($"{file_name}");

                            counter++;


                        File.WriteAllText(path + file_name + ".strm", vlc_napster_link + codice_uptobox);

                    }

                    Console.WriteLine($"I file scritti sono:{counter}");

                    streamReader.Close();

                }

                Console.ReadKey();

                Console.Clear();

                goto MENU;

            }
            
        }
    }
}
